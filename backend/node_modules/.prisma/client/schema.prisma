generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String                  @id @default(cuid())
  email              String                  @unique
  passwordHash       String                  @map("password_hash")
  name               String?
  role               Role                    @default(BUYER)
  status             UserStatus              @default(ACTIVE)
  isActive           Boolean                 @default(true)
  emailVerified      EmailVerificationStatus @default(UNVERIFIED)
  verificationToken  String?                 @map("verification_token")
  resetPasswordToken String?                 @map("reset_password_token")
  resetTokenExpiry   DateTime?               @map("reset_token_expiry")
  createdAt          DateTime                @default(now())
  updatedAt          DateTime                @updatedAt

  auditLogs AuditLog[]
  profiles  Profile[]
  sessions  UserSession[]

  @@index([email], map: "idx_accounts_email")
  @@index([role], map: "idx_accounts_role")
  @@index([status], map: "idx_accounts_status")
  @@map("accounts")
}

model Profile {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  avatarUrl  String?  @map("avatar_url")
  bio        String?
  phone      String?
  address    String?
  city       String?
  country    String?
  postalCode String?  @map("postal_code")
  isVerified Boolean  @default(false) @map("is_verified")
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_profiles_user_id")
  @@map("profiles")
}

model UserSession {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  token        String   @unique
  refreshToken String?  @map("refresh_token")
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  expiresAt    DateTime @map("expires_at")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "idx_user_sessions_user_id")
  @@map("user_sessions")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String?  @map("user_id")
  action    String
  resource  String?
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  details   Json?
  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id])

  @@index([action], map: "idx_audit_logs_action")
  @@index([userId], map: "idx_audit_logs_user_id")
  @@map("audit_logs")
}

model Product {
  id          String   @id @default(cuid())
  title       String
  description String?
  category    String
  price       Float
  images      String[]
  sellerId    String   @map("seller_id")
  status      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([sellerId], map: "idx_products_seller_id")
  @@index([status], map: "idx_products_status")
  @@map("products")
}

model Auction {
  id         String   @id @default(cuid())
  title      String
  productId  String   @map("product_id")
  sellerId   String   @map("seller_id")
  startPrice Float    @map("start_price")
  currentBid Float    @map("current_bid")
  endTime    DateTime @map("end_time")
  status     String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([sellerId], map: "idx_auctions_seller_id")
  @@index([status], map: "idx_auctions_status")
  @@map("auctions")
}

enum Role {
  ADMIN
  SELLER
  BUYER
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
  REJECTED
  DELETED
}

enum EmailVerificationStatus {
  VERIFIED
  UNVERIFIED
  PENDING
}

enum PasswordResetStatus {
  NONE
  PENDING
  COMPLETED
}
