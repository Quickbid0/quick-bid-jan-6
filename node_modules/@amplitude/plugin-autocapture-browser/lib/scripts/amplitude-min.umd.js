!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).amplitude={})}(this,function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function n(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function l(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}u((r=r.apply(e,t||[])).next())})}function r(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,r=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){i=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){i.label=l[1];break}if(6===l[0]&&i.label<o[1]){i.label=o[1],o=l;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(l);break}o[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(e){l=[6,e],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function i(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function a(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var l=function(){var e="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[e]?globalThis[e]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0},u=function(e,t){return!t||!t.length||t.some(function(t){return"string"==typeof t?e===t:e.match(t)})},c=l(),s=null==c?void 0:c.console,d={},f={},v=!1;var p={addListener:function(e,t){var n,r=(n=e,!!s&&"function"==typeof s[n]&&(f[n]||(f[n]=s[n],s[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{if(d[n]&&!v){v=!0;var r=d[n];r&&r.forEach(function(t){try{t(n,e)}catch(e){}})}}catch(e){}return v=!1,f[n].apply(s,e)}),!0));if(!r)return new Error("Console override failed");d[e]?d[e].push(t):d[e]=[t]},removeListener:function(e){var t,n;try{for(var r=o(Object.values(d)),i=r.next();!i.done;i=r.next())for(var a=i.value,l=a.length-1;l>=0;l--)if(a[l]===e){a.splice(l,1);break}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},_restoreConsole:function(){var e,t;try{for(var n=o(Object.entries(f)),r=n.next();!r.done;r=n.next()){var a=i(r.value,2),l=a[0],u=a[1];u&&(s[l]=u)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}f={},d={}}},h=["a","button","input","select","textarea","label","video","audio",'[contenteditable="true" i]',"[data-amp-default-track]",".amp-default-track"],g="data-amp-track-",m=["div","span","h1","h2","h3","h4","h5","h6"],b=a(['input[type="button"]','input[type="submit"]','input[type="reset"]','input[type="image"]','input[type="file"]'],i(["a","button",'[role="button"]','[role="link"]','[role="menuitem"]','[role="menuitemcheckbox"]','[role="menuitemradio"]','[role="option"]','[role="tab"]','[role="treeitem"]','[contenteditable="true" i]']),!1),y=b,w=b,E=["*"],T="data-amp-mask",k="*****",x=/\b(?:\d[ -]*?){13,16}\b/,A=/(\d{3}-?\d{2}-?\d{4})/g,C=/[^\s@]+@[^\s@.]+\.[^\s@]+/g;function O(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}var M=function(){return"function"==typeof Symbol},L=function(e){return M()&&Boolean(Symbol[e])},N=function(e){return L(e)?Symbol[e]:"@@"+e};M()&&!L("observable")&&(Symbol.observable=Symbol("observable"));var R=N("iterator"),D=N("observable"),I=N("species");function j(e,t){var n=e[t];if(null!=n){if("function"!=typeof n)throw new TypeError(n+" is not a function");return n}}function q(e){var t=e.constructor;return void 0!==t&&null===(t=t[I])&&(t=void 0),void 0!==t?t:W}function H(e){return e instanceof W}function U(e){U.log?U.log(e):setTimeout(function(){throw e})}function G(e){Promise.resolve().then(function(){try{e()}catch(e){U(e)}})}function X(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var n=j(t,"unsubscribe");n&&n.call(t)}}catch(e){U(e)}}function F(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function B(e,t,n){e._state="running";var r=e._observer;try{var o=j(r,t);switch(t){case"next":o&&o.call(r,n);break;case"error":if(F(e),!o)throw n;o.call(r,n);break;case"complete":F(e),o&&o.call(r)}}catch(e){U(e)}"closed"===e._state?X(e):"running"===e._state&&(e._state="ready")}function Y(e,t,n){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:n}],void G(function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var n=0;n<t.length&&(B(e,t[n].type,t[n].value),"closed"!==e._state);++n);}}(e)})):void B(e,t,n);e._queue.push({type:t,value:n})}}var z=function(){function e(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";var n=new V(this);try{this._cleanup=t.call(void 0,n)}catch(e){n.error(e)}"initializing"===this._state&&(this._state="ready")}return e.prototype.unsubscribe=function(){"closed"!==this._state&&(F(this),X(this))},_(e,[{key:"closed",get:function(){return"closed"===this._state}}]),e}(),V=function(){function e(e){this._subscription=e}var t=e.prototype;return t.next=function(e){Y(this._subscription,"next",e)},t.error=function(e){Y(this._subscription,"error",e)},t.complete=function(){Y(this._subscription,"complete")},_(e,[{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),W=function(){function e(t){if(!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}var t=e.prototype;return t.subscribe=function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new z(e,this._subscriber)},t.forEach=function(e){var t=this;return new Promise(function(n,r){if("function"==typeof e)var o=t.subscribe({next:function(t){try{e(t,i)}catch(e){r(e),o.unsubscribe()}},error:r,complete:n});else r(new TypeError(e+" is not a function"));function i(){o.unsubscribe(),n()}})},t.map=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(q(this))(function(n){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return n.error(e)}n.next(t)},error:function(e){n.error(e)},complete:function(){n.complete()}})})},t.filter=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(q(this))(function(n){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return n.error(e)}n.next(t)},error:function(e){n.error(e)},complete:function(){n.complete()}})})},t.reduce=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var n=q(this),r=arguments.length>1,o=!1,i=arguments[1];return new n(function(n){return t.subscribe({next:function(t){var a=!o;if(o=!0,!a||r)try{i=e(i,t)}catch(e){return n.error(e)}else i=t},error:function(e){n.error(e)},complete:function(){if(!o&&!r)return n.error(new TypeError("Cannot reduce an empty sequence"));n.next(i),n.complete()}})})},t.concat=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=q(this);return new o(function(t){var r,i=0;return function e(a){r=a.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){i===n.length?(r=void 0,t.complete()):e(o.from(n[i++]))}})}(e),function(){r&&(r.unsubscribe(),r=void 0)}})},t.flatMap=function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var n=q(this);return new n(function(r){var o=[],i=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return r.error(e)}var i=n.from(t).subscribe({next:function(e){r.next(e)},error:function(e){r.error(e)},complete:function(){var e=o.indexOf(i);e>=0&&o.splice(e,1),a()}});o.push(i)},error:function(e){r.error(e)},complete:function(){a()}});function a(){i.closed&&0===o.length&&r.complete()}return function(){o.forEach(function(e){return e.unsubscribe()}),i.unsubscribe()}})},t[D]=function(){return this},e.from=function(t){var n="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var r=j(t,D);if(r){var o=r.call(t);if(Object(o)!==o)throw new TypeError(o+" is not an object");return H(o)&&o.constructor===n?o:new n(function(e){return o.subscribe(e)})}if(L("iterator")&&(r=j(t,R)))return new n(function(e){G(function(){if(!e.closed){for(var n,o=O(r.call(t));!(n=o()).done;){var i=n.value;if(e.next(i),e.closed)return}e.complete()}})});if(Array.isArray(t))return new n(function(e){G(function(){if(!e.closed){for(var n=0;n<t.length;++n)if(e.next(t[n]),e.closed)return;e.complete()}})});throw new TypeError(t+" is not observable")},e.of=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return new("function"==typeof this?this:e)(function(e){G(function(){if(!e.closed){for(var t=0;t<n.length;++t)if(e.next(n[t]),e.closed)return;e.complete()}})})},_(e,null,[{key:I,get:function(){return this}}]),e}();function J(e,t){return new W(function(n){e.subscribe({next:function(e){t(e).then(function(e){return n.next(e)}).catch(function(e){return n.error(e)})},error:function(e){n.error(e)},complete:function(){n.complete()}})})}function K(e,t){return new W(function(n){var r=!1,i=new Set,a=function(){var e,t;r=!0;try{for(var n=o(i),a=n.next();!a.done;a=n.next()){var l=a.value;try{l.unsubscribe()}catch(e){}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}i.clear()},l=function(e){var t=e.subscribe({next:function(e){r||n.next(e)},error:function(e){r||(r=!0,n.error(e),a())},complete:function(){i.delete(t),r||0!==i.size||(n.complete(),a(),r=!0)}});i.add(t)};return l(e),l(t),a})}function Z(e){var t=new Set,n=null;function r(){null==n||n.unsubscribe(),n=null,t.clear()}return new W(function(i){return t.add(i),null===n&&(n=e.subscribe({next:function(e){var n,r,i;try{for(var a=o(t),l=a.next();!l.done;l=a.next()){var u=l.value;null===(i=u.next)||void 0===i||i.call(u,e)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}},error:function(e){var n,i,a;try{for(var l=o(t),u=l.next();!u.done;u=l.next()){var c=u.value;null===(a=c.error)||void 0===a||a.call(c,e)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}r()},complete:function(){var e,n,i;try{for(var a=o(t),l=a.next();!l.done;l=a.next()){var u=l.value;null===(i=u.complete)||void 0===i||i.call(u)}}catch(t){e={error:t}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}r()}})),function(){t.delete(i),0===t.size&&n&&(n.unsubscribe(),n=null)}})}M()&&Object.defineProperty(W,Symbol("extensions"),{value:{symbol:D,hostReportError:U},configurable:!0});var $="1.20.0",Q="[Amplitude] Element Clicked",ee="[Amplitude] Element Tag",te="[Amplitude] Element Text",ne="[Amplitude] Page URL",re="https://app.amplitude.com",oe={US:re,EU:"https://app.eu.amplitude.com",STAGING:"https://apps.stag2.amplitude.com"},ie="data-amp-mask-attributes",ae=["input","select","textarea"],le=function(e,t){var n,r=null===(n=null===window||void 0===window?void 0:window.getComputedStyle)||void 0===n?void 0:n.call(window,e);return"pointer"===(null==r?void 0:r.getPropertyValue("cursor"))&&"click"===t},ue=function(e){var t=e.pageUrlAllowlist,n=e.pageUrlExcludelist;return!(n&&n.length>0&&u(window.location.href,n))&&!!u(window.location.href,t)},ce=function(e,t,n){return void 0===n&&(n=!1),function(r,o){var i,a,l=e.shouldTrackEventResolver,u=null===(a=null===(i=null==o?void 0:o.tagName)||void 0===i?void 0:i.toLowerCase)||void 0===a?void 0:a.call(i);if(!u)return!1;if(l)return l(r,o);if(!ue(e))return!1;var c=String(null==o?void 0:o.getAttribute("type"))||"";if("string"==typeof c)switch(c.toLowerCase()){case"hidden":case"password":return!1}var s=le(o,r);if(n&&s)return!0;if(t){var d=t.some(function(e){var t;return!!(null===(t=null==o?void 0:o.matches)||void 0===t?void 0:t.call(o,e))});if(!d)return!1}switch(u){case"input":case"select":case"textarea":return"change"===r||"click"===r;default:return!!s||"click"===r}}},se=function(e){return e?e.split(",").map(function(e){return e.trim()}).filter(function(e){return e.length>0&&"id"!==e&&"class"!==e}):[]},de=function(e){return Object.keys(e).reduce(function(t,n){var r=e[n];return function(e){return null==e||"object"==typeof e&&0===Object.keys(e).length||"string"==typeof e&&0===e.trim().length}(r)||(t[n]=r),t},{})},fe=function(e,t){return e?t.some(function(t){var n;return null===(n=null==e?void 0:e.matches)||void 0===n?void 0:n.call(e,t)})?e:fe(null==e?void 0:e.parentElement,t):null};var ve,pe=function(e){return!(null===e.event.target||!e.closestTrackedAncestor)};!function(e){e[e.LEFT_OR_TOUCH_CONTACT=0]="LEFT_OR_TOUCH_CONTACT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT"}(ve||(ve={}));var he=new Set(["id","class","style","value","onclick","onchange","oninput","onblur","onsubmit","onfocus","onkeydown","onkeyup","onkeypress","data-reactid","data-react-checksum","data-reactroot",ie,T]),ge=["type"],me=["svg","path","g"],be=["password","hidden"];function ye(e,t){var n,r,i,a,l,u;if(null===e)return null;var c=String(e.tagName).toLowerCase(),s={tag:c},d=Array.from(null!==(a=null===(i=e.parentElement)||void 0===i?void 0:i.children)&&void 0!==a?a:[]);d.length&&(s.index=d.indexOf(e),s.indexOfType=d.filter(function(t){return t.tagName===e.tagName}).indexOf(e));var f=null===(u=null===(l=e.previousElementSibling)||void 0===l?void 0:l.tagName)||void 0===u?void 0:u.toLowerCase();f&&(s.prevSib=String(f));var v=e.getAttribute("id");v&&(s.id=String(v));var p=Array.from(e.classList);p.length&&(s.classes=p);var h={},g=Array.from(e.attributes).filter(function(e){return!he.has(e.name)}),m=!function(e){var t,n,r,o=null===(n=null===(t=null==e?void 0:e.tagName)||void 0===t?void 0:t.toLowerCase)||void 0===n?void 0:n.call(t),i=e instanceof HTMLElement&&"true"===(null===(r=e.getAttribute("contenteditable"))||void 0===r?void 0:r.toLowerCase());return!ae.includes(o)&&!i}(e);if(!be.includes(String(e.getAttribute("type")))&&!me.includes(c))try{for(var b=o(g),y=b.next();!y.done;y=b.next()){var w=y.value;m&&!ge.includes(w.name)||(t.has(w.name)?h[w.name]=k:h[w.name]=String(w.value).substring(0,128))}}catch(e){n={error:e}}finally{try{y&&!y.done&&(r=b.return)&&r.call(b)}finally{if(n)throw n.error}}return Object.keys(h).length&&(s.attrs=h),s}var we=function(e,t,n){e.forEach(function(e){if("string"!=typeof e&&"ATTACH_EVENT_PROPERTY"===e.actionType){var r=n.extractDataFromDataSource(e.dataSource,t.closestTrackedAncestor);t.targetElementProperties[e.destinationKey]=r}})},Ee=function(e,t){var n,r,l,u=this;this.replaceSensitiveString=function(e){return function(e,t){var n,r;if(void 0===t&&(t=[]),"string"!=typeof e)return"";var i=e;i=(i=(i=i.replace(x,k)).replace(A,k)).replace(C,k);try{for(var a=o(t),l=a.next();!l.done;l=a.next()){var u=l.value;try{i=i.replace(u,k)}catch(e){}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}(e,u.additionalMaskTextPatterns)},this.getHierarchy=function(e){var t,n,r,l,c,s=performance.now();if(!e)return[];for(var d=function(e){var t=[];if(!e)return t;t.push(e);for(var n=e.parentElement;n&&"HTML"!==n.tagName;)t.push(n),n=n.parentElement;return t}(e),f=new Map,v=d.length-1;v>=0;v--){var p=d[v];if(p){var h=se(p.getAttribute(ie)),g=v===d.length-1?[]:null!==(r=f.get(d[v+1]))&&void 0!==r?r:new Set,m=new Set(a(a([],i(g),!1),i(h),!1));f.set(p,m)}}c=d.map(function(e){var t;return ye(e,null!==(t=f.get(e))&&void 0!==t?t:new Set)});var b=function(e){(null==e?void 0:e.attrs)&&Object.entries(e.attrs).forEach(function(t){var n=i(t,2),r=n[0],o=n[1];e.attrs&&(e.attrs[r]=u.replaceSensitiveString(o))})};try{for(var y=o(c),w=y.next();!w.done;w=y.next())b(w.value)}catch(e){t={error:e}}finally{try{w&&!w.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}var E=performance.now();return null===(l=u.diagnosticsClient)||void 0===l||l.recordHistogram("autocapturePlugin.getHierarchy",E-s),c},this.getNearestLabel=function(e){var t,n=e.parentElement;if(!n)return"";try{t=n.querySelector(":scope>span,h1,h2,h3,h4,h5,h6")}catch(e){t=null}return t?u.getText(t):u.getNearestLabel(n)},this.getEventProperties=function(e,t,n){var r,o,a,l,c,s,d=null===(a=null===(o=null==t?void 0:t.tagName)||void 0===o?void 0:o.toLowerCase)||void 0===a?void 0:a.call(o),f="function"==typeof t.getBoundingClientRect?t.getBoundingClientRect():{left:null,top:null},v=u.getHierarchy(t),p=null===(l=v[0])||void 0===l?void 0:l.attrs,h=u.getNearestLabel(t),g=(c=null!=p?p:{},s=n,Object.entries(c).reduce(function(e,t){var n=i(t,2),r=n[0],o=n[1];if(r.startsWith(s)){var a=r.replace(s,"");a&&(e[a]=o||"")}return e},{})),m=((r={})["[Amplitude] Element Hierarchy"]=v,r[ee]=d,r[te]=u.getText(t),r["[Amplitude] Element Position Left"]=null==f.left?null:Math.round(f.left),r["[Amplitude] Element Position Top"]=null==f.top?null:Math.round(f.top),r["[Amplitude] Element Attributes"]=g,r["[Amplitude] Element Parent Label"]=h,r[ne]=function(e,t){var n=e;try{n=decodeURI(e)}catch(e){null==t||t.error("Malformed URI sequence: ",e)}return n}(window.location.href.split("?")[0]),r["[Amplitude] Page Title"]=function(e){if("undefined"==typeof document||!document.title)return"";var t=document.querySelector("title");return t&&t.hasAttribute(T)?k:e?e(document.title):document.title}(u.replaceSensitiveString),r["[Amplitude] Viewport Height"]=window.innerHeight,r["[Amplitude] Viewport Width"]=window.innerWidth,r);if(m["[Amplitude] Element ID"]=t.getAttribute("id")||"",m["[Amplitude] Element Class"]=t.getAttribute("class"),m["[Amplitude] Element Aria Label"]=null==p?void 0:p["aria-label"],"a"===d&&"click"===e&&t instanceof HTMLAnchorElement){var b=t.href.substring(0,128);m["[Amplitude] Element Href"]=u.replaceSensitiveString(b)}return de(m)},this.addTypeAndTimestamp=function(e,t){return{event:e,timestamp:Date.now(),type:t}},this.addAdditionalEventProperties=function(e,t,n,r,o){void 0===o&&(o=!1);var i=u.addTypeAndTimestamp(e,t);if(function(e){return"click"===e.type||"change"===e.type}(i)&&null!==i.event.target){if(o&&le(i.event.target,i.type))return i.closestTrackedAncestor=i.event.target,i.targetElementProperties=u.getEventProperties(i.type,i.closestTrackedAncestor,r),i;var a=fe(i.event.target,n);return a&&(i.closestTrackedAncestor=a,i.targetElementProperties=u.getEventProperties(i.type,a,r)),i}return i},this.extractDataFromDataSource=function(e,t){if("DOM_ELEMENT"===e.sourceType){var n=function(e,t){try{if("DOM_ELEMENT"===e.sourceType){var n=document.documentElement;return e.scope&&t&&(n=t.closest(e.scope)),n&&e.selector?n.querySelector(e.selector):n}}catch(e){return}}(e,t);if(!n)return;return"TEXT"===e.elementExtractType?u.getText(n):"ATTRIBUTE"===e.elementExtractType&&e.attribute?n.getAttribute(e.attribute):void 0}},this.getText=function(e){if(null!==e.closest("[".concat(T,"]")))return k;var t="";if(e.querySelector("[".concat(T,"], [contenteditable]"))){var n=e.cloneNode(!0);n.querySelectorAll("[".concat(T,"], [contenteditable]")).forEach(function(e){e.innerText=k}),t=n.innerText||""}else t=e.innerText||"";return u.replaceSensitiveString(t.substring(0,255)).replace(/\s+/g," ").trim()},this.getEventTagProps=function(e){var t,n,r;if(!e)return{};var o=null===(r=null===(n=null==e?void 0:e.tagName)||void 0===n?void 0:n.toLowerCase)||void 0===r?void 0:r.call(n),i=((t={})[ee]=o,t[te]=u.getText(e),t[ne]=window.location.href.split("?")[0],t);return de(i)},this.diagnosticsClient=null==t?void 0:t.diagnosticsClient;var c=null!==(l=e.maskTextRegex)&&void 0!==l?l:[],s=[];try{for(var d=o(c),f=d.next();!f.done;f=d.next()){var v=f.value;if(s.length>=25)break;if(v instanceof RegExp)s.push(v);else if("pattern"in v&&"string"==typeof v.pattern)try{s.push(new RegExp(v.pattern,"i"))}catch(e){}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}this.additionalMaskTextPatterns=s},Te=function(){function e(e){var t=(void 0===e?{}:e).origin,n=void 0===t?re:t,r=this;this.endpoint=re,this.requestCallbacks={},this.onSelect=function(e){r.notify({action:"element-selected",data:e})},this.onTrack=function(e,t){"selector-mode-changed"===e?r.notify({action:"track-selector-mode-changed",data:t}):"selector-moved"===e&&r.notify({action:"track-selector-moved",data:t})},this.endpoint=n}return e.prototype.notify=function(e){var t,n,r,o;null===(n=null===(t=this.logger)||void 0===t?void 0:t.debug)||void 0===n||n.call(t,"Message sent: ",JSON.stringify(e)),null===(o=null===(r=window.opener)||void 0===r?void 0:r.postMessage)||void 0===o||o.call(r,e,this.endpoint)},e.prototype.sendRequest=function(e,t,n){var r=this;void 0===n&&(n={timeout:15e3});var o="".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),i={id:o,action:e,args:t};return new Promise(function(t,a){r.requestCallbacks[o]={resolve:t,reject:a},r.notify(i),(null==n?void 0:n.timeout)>0&&setTimeout(function(){a(new Error("".concat(e," timed out (id: ").concat(o,")"))),delete r.requestCallbacks[o]},n.timeout)})},e.prototype.handleResponse=function(e){var t;this.requestCallbacks[e.id]?(this.requestCallbacks[e.id].resolve(e.responseData),delete this.requestCallbacks[e.id]):null===(t=this.logger)||void 0===t||t.warn("No callback found for request id: ".concat(e.id))},e.prototype.setup=function(e){var t=this,n=void 0===e?{dataExtractor:new Ee({})}:e,r=n.logger,o=n.endpoint,i=n.isElementSelectable,a=n.cssSelectorAllowlist,l=n.actionClickAllowlist,u=n.dataExtractor;this.logger=r,o&&this.endpoint===re&&(this.endpoint=o);var c=null;window.addEventListener("message",function(e){var n,r,o,s,d;if(null===(r=null===(n=t.logger)||void 0===n?void 0:n.debug)||void 0===r||r.call(n,"Message received: ",JSON.stringify(e)),t.endpoint===e.origin){var f,v=null==e?void 0:e.data,p=null==v?void 0:v.action;if(p)if("id"in v)null===(s=null===(o=t.logger)||void 0===o?void 0:o.debug)||void 0===s||s.call(o,"Received Response to previous request: ",JSON.stringify(e)),t.handleResponse(v);else if("ping"===p)t.notify({action:"pong"});else if("initialize-visual-tagging-selector"===p){var h=null==v?void 0:v.data;(f="https://cdn.amplitude.com/libs/visual-tagging-selector-1.0.0-alpha.js.gz",new Promise(function(e,t){var n;try{var r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=f,r.addEventListener("load",function(){e({status:!0})},{once:!0}),r.addEventListener("error",function(){t({status:!1,message:"Failed to load the script ".concat(f)})}),null===(n=document.head)||void 0===n||n.appendChild(r)}catch(e){t(e)}})).then(function(){var e;c=null===(e=null===window||void 0===window?void 0:window.amplitudeVisualTaggingSelector)||void 0===e?void 0:e.call(window,{getEventTagProps:u.getEventTagProps,isElementSelectable:function(e){return!i||i((null==h?void 0:h.actionType)||"click",e)},onTrack:t.onTrack,onSelect:t.onSelect,visualHighlightClass:"amp-visual-tagging-selector-highlight",messenger:t,cssSelectorAllowlist:a,actionClickAllowlist:l,extractDataFromDataSource:u.extractDataFromDataSource,dataExtractor:u,diagnostics:{autocapture:{version:$}}}),t.notify({action:"selector-loaded"})}).catch(function(){var e;null===(e=t.logger)||void 0===e||e.warn("Failed to initialize visual tagging selector")})}else"close-visual-tagging-selector"===p&&(null===(d=null==c?void 0:c.close)||void 0===d||d.call(c))}}),this.notify({action:"page-loaded"})},e}();var ke,xe=l(),Ae=function(){return new W(function(e){var t=new MutationObserver(function(t){e.next(t)});return document.body&&t.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),function(){return t.disconnect()}})},Ce=function(e){return void 0===e&&(e="click"),new W(function(t){var n=function(e){t.next(e)};return xe.document.addEventListener(e,n,{capture:!0}),function(){xe.document.removeEventListener(e,n,{capture:!0})}})},Oe=function(){var e=K(new W(function(e){var n=function(n){if(n instanceof ErrorEvent){var r={kind:"error"};n.error instanceof Error||n.error instanceof DOMException?r=t(t({},r),{message:n.error.message,stack:n.error.stack,filename:n.filename,lineNumber:n.lineno,columnNumber:n.colno}):"string"==typeof n.error&&(r.message=n.error),e.next(r)}};return xe.addEventListener("error",n),function(){xe.removeEventListener("error",n)}}),new W(function(e){var t=function(t){var n={kind:"unhandledrejection"};t.reason instanceof Error||t.reason instanceof DOMException?(n.message=t.reason.message,n.stack=t.reason.stack):"string"==typeof t.reason&&(n.message=t.reason),e.next(n)};return xe.addEventListener("unhandledrejection",t),function(){xe.removeEventListener("unhandledrejection",t)}}));return K(e,new W(function(e){var t=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=void 0;Array.isArray(n[0])&&"string"==typeof n[0][0]&&(o=n[0][0]),e.next({kind:"console",message:o})};return p.addListener("error",t),function(){p.removeListener(t)}}))},Se={"[Amplitude] Element Clicked":"click","[Amplitude] Element Changed":"change"},Pe=function(e){var t,n,r,i,a=Object.values(Se).reduce(function(e,t){return e[t]=new Set,e},{});if(!e)return a;try{for(var l=o(e),u=l.next();!u.done;u=l.next()){var c=u.value;try{try{for(var s=(r=void 0,o(c.definition)),d=s.next();!d.done;d=s.next()){var f=d.value,v=Se[f.event_type];v&&a[v].add(c.id)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}catch(e){console.warn("Skipping Labeled Event due to malformed definition",null==c?void 0:c.id,e)}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return a},_e=function(e){var t,n,r,i,a=new Map;try{for(var l=o(e),u=l.next();!u.done;u=l.next()){var c=u.value;try{for(var s=(r=void 0,o(c.conditions)),d=s.next();!d.done;d=s.next()){var f=d.value;if("LABELED_EVENT"===f.type){var v=f.match.eventId,p=a.get(v);p||(p=[],a.set(v,p)),p.push(c)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return a},Me=function(e,t){return t.filter(function(t){return t.definition.some(function(t){return Se[t.event_type]===e.type&&t.filters.every(function(t){return function(e,t){try{if("[Amplitude] Element Text"===t.subprop_key)return"is"===t.subprop_op&&t.subprop_value.includes(e.targetElementProperties["[Amplitude] Element Text"]);if("[Amplitude] Element Hierarchy"===t.subprop_key)return"autotrack css match"===t.subprop_op&&!!e.closestTrackedAncestor.closest(t.subprop_value.toString())}catch(e){return console.error("Error matching event to filter",e),!1}return!1}(e,t)})})})},Le=function(){function e(e,t,n,r){this.groupedLabeledEvents=e,this.labeledEventToTriggerMap=t,this.dataExtractor=n,this.options=r}return e.prototype.evaluate=function(e){var t,n,r=this.options.pageActions;if(!r)return e;var i=function(e,t){var n,r,i,a,l=new Set;try{for(var u=o(e),c=u.next();!c.done;c=u.next()){var s=c.value,d=t.get(s.id);if(d)try{for(var f=(i=void 0,o(d)),v=f.next();!v.done;v=f.next()){var p=v.value;l.add(p)}}catch(e){i={error:e}}finally{try{v&&!v.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return Array.from(l)}(Me(e,Array.from(this.groupedLabeledEvents[e.type]).map(function(e){return r.labeledEvents[e]})),this.labeledEventToTriggerMap);try{for(var a=o(i),l=a.next();!l.done;l=a.next()){var u=l.value;we(u.actions,e,this.dataExtractor)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return e},e.prototype.update=function(e,t,n){this.groupedLabeledEvents=e,this.labeledEventToTriggerMap=t,this.options=n},e}();!function(e){e.ClickObservable="clickObservable",e.ChangeObservable="changeObservable",e.NavigateObservable="navigateObservable",e.MutationObservable="mutationObservable",e.BrowserErrorObservable="browserErrorObservable",e.SelectionObservable="selectionObservable",e.MouseMoveObservable="mouseMoveObservable"}(ke||(ke={}));var Ne=function(e,u){var c,s,d,f,v,p,b,y;void 0===e&&(e={}),null==u||u.diagnosticsClient.setTag("plugin.autocapture.version",$);var w=e.dataAttributePrefix,E=void 0===w?g:w,T=e.visualTaggingOptions,k=void 0===T?{enabled:!0,messenger:new Te}:T;e.cssSelectorAllowlist=null!==(c=e.cssSelectorAllowlist)&&void 0!==c?c:h,e.actionClickAllowlist=null!==(s=e.actionClickAllowlist)&&void 0!==s?s:m,e.debounceTime=null!==(d=e.debounceTime)&&void 0!==d?d:0,e.pageUrlExcludelist=null===(f=e.pageUrlExcludelist)||void 0===f?void 0:f.reduce(function(e,t){if("string"==typeof t&&e.push(t),t instanceof RegExp&&e.push(t),"object"==typeof t&&null!==t&&"pattern"in t)try{e.push(new RegExp(t.pattern))}catch(n){return console.warn("Invalid regex pattern: ".concat(t.pattern),n),e}return e},[]);var x="@amplitude/plugin-autocapture-browser",A=[],C=new Ee(e,u),O=Pe(Object.values(null!==(p=null===(v=e.pageActions)||void 0===v?void 0:v.labeledEvents)&&void 0!==p?p:{})),S=_e(null!==(y=null===(b=e.pageActions)||void 0===b?void 0:b.triggers)&&void 0!==y?y:[]),P=function(e,t,n,r){return new Le(e,t,n,r)}(O,S,C,e);return{name:x,type:"enrichment",setup:function(o,u){return n(void 0,void 0,void 0,function(){var n,c,s,d,f,v,p,h,g,m;return r(this,function(r){return"undefined"==typeof document||(o.fetchRemoteConfig&&(o.remoteConfigClient?o.remoteConfigClient.subscribe("configs.analyticsSDK.pageActions","all",function(n){!function(n){var r,o;n&&(e.pageActions=t(t({},e.pageActions),n),O=Pe(Object.values(null!==(r=e.pageActions.labeledEvents)&&void 0!==r?r:{})),S=_e(null!==(o=e.pageActions.triggers)&&void 0!==o?o:[]),P.update(O,S,e))}(n)}):o.loggerProvider.debug("Remote config client is not provided, skipping remote config fetch")),n=ce(e,e.cssSelectorAllowlist),c=ce(e,e.actionClickAllowlist),s=function(){var t,n,r=Z(Ce().map(function(t){return C.addAdditionalEventProperties(t,"click",e.cssSelectorAllowlist,E)})),o=Z(new W(function(t){var n,r=function(n){var r=C.addAdditionalEventProperties(n,"change",e.cssSelectorAllowlist,E);t.next(r)};return null===(n=l())||void 0===n||n.document.addEventListener("change",r,{capture:!0}),function(){var e;return null===(e=l())||void 0===e?void 0:e.document.removeEventListener("change",r)}}));window.navigation&&(n=Z(new W(function(t){var n=function(n){var r=C.addAdditionalEventProperties(n,"navigate",e.cssSelectorAllowlist,E);t.next(r)};return window.navigation.addEventListener("navigate",n),function(){window.navigation.removeEventListener("navigate",n)}})));var i=Z(Ae().map(function(t){return C.addAdditionalEventProperties(t,"mutation",e.cssSelectorAllowlist,E)}));return(t={})[ke.ChangeObservable]=o,t[ke.ClickObservable]=r,t[ke.MutationObservable]=i,t[ke.NavigateObservable]=n,t}(),d=function(e){var t=e.amplitude,n=e.allObservables,r=e.shouldTrackEvent,o=e.evaluateTriggers;return n.clickObservable.filter(pe).filter(function(e){return r("click",e.closestTrackedAncestor)}).map(function(e){return o(e)}).subscribe(function(e){null==t||t.track(Q,e.targetElementProperties)})}({allObservables:s,amplitude:u,shouldTrackEvent:n,evaluateTriggers:P.evaluate.bind(P)}),A.push(d),f=function(e){var t=e.amplitude,n=e.allObservables,r=e.getEventProperties,o=e.shouldTrackEvent,i=e.evaluateTriggers;return n.changeObservable.filter(pe).filter(function(e){return o("change",e.closestTrackedAncestor)}).map(function(e){return i(e)}).subscribe(function(e){null==t||t.track("[Amplitude] Element Changed",r("change",e.closestTrackedAncestor))})}({allObservables:s,getEventProperties:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return C.getEventProperties.apply(C,a(a([],i(e),!1),[E],!1))},amplitude:u,shouldTrackEvent:n,evaluateTriggers:P.evaluate.bind(P)}),A.push(f),v=function(e){var t=e.amplitude,n=e.allObservables,r=e.options,o=e.getEventProperties,i=e.shouldTrackEvent,a=e.shouldTrackActionClick,l=n.clickObservable,u=n.mutationObservable,c=n.navigateObservable,s=l.filter(function(e){return!i("click",e.closestTrackedAncestor)}).map(function(e){var t=fe(e.event.target,r.actionClickAllowlist);return e.closestTrackedAncestor=t,null!==e.closestTrackedAncestor&&(e.targetElementProperties=o(e.type,e.closestTrackedAncestor)),e}).filter(pe).filter(function(e){return a("click",e.closestTrackedAncestor)}),d=c?K(u,c):u,f=K(s,d),v=null,p=null;return J(f,function(e){if(v&&(clearTimeout(v),v=null),"click"===e.type)return p=e,v=setTimeout(function(){v=null,p=null},500),Promise.resolve(null);if(p){var t=p;return p=null,Promise.resolve(t)}return Promise.resolve(null)}).subscribe(function(e){e&&(null==t||t.track(Q,o("click",e.closestTrackedAncestor)))})}({allObservables:s,options:e,getEventProperties:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return C.getEventProperties.apply(C,a(a([],i(e),!1),[E],!1))},amplitude:u,shouldTrackEvent:n,shouldTrackActionClick:c}),v&&A.push(v),null===(g=null==o?void 0:o.loggerProvider)||void 0===g||g.log("".concat(x," has been successfully added.")),window.opener&&k.enabled&&(p=e.cssSelectorAllowlist,h=e.actionClickAllowlist,null===(m=k.messenger)||void 0===m||m.setup(t(t({dataExtractor:C,logger:null==o?void 0:o.loggerProvider},(null==o?void 0:o.serverZone)&&{endpoint:oe[o.serverZone]}),{isElementSelectable:ce(e,a(a([],i(p),!1),i(h),!1)),cssSelectorAllowlist:p,actionClickAllowlist:h})))),[2]})})},execute:function(e){return n(void 0,void 0,void 0,function(){return r(this,function(t){return[2,e]})})},teardown:function(){return n(void 0,void 0,void 0,function(){var e,t,n,i;return r(this,function(r){try{for(e=o(A),t=e.next();!t.done;t=e.next())t.value.unsubscribe()}catch(e){n={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(n)throw n.error}}return[2]})})}}},Re=["mutation","navigate"];function De(e,t){var n,r,o,i,a=t.event,l=a.pageX,u=a.pageY;e.yMin=Math.min(null!==(n=e.yMin)&&void 0!==n?n:u,u),e.yMax=Math.max(null!==(r=e.yMax)&&void 0!==r?r:u,u),e.xMin=Math.min(null!==(o=e.xMin)&&void 0!==o?o:l,l),e.xMax=Math.max(null!==(i=e.xMax)&&void 0!==i?i:l,l),e.isOutOfBounds=e.yMax-e.yMin>50||e.xMax-e.xMin>50}function Ie(e){if(0===e.length)return null;var n=e[0],r=e[e.length-1];return{rageClickEvent:t({"[Amplitude] Begin Time":new Date(n.timestamp).toISOString(),"[Amplitude] End Time":new Date(r.timestamp).toISOString(),"[Amplitude] Duration":r.timestamp-n.timestamp,"[Amplitude] Clicks":e.map(function(e){return{X:e.event.pageX,Y:e.event.pageY,Time:e.timestamp}}),"[Amplitude] Click Count":e.length},n.targetElementProperties),time:n.timestamp}}function je(e){var t=this,o=e.amplitude,i=e.allObservables,a=e.shouldTrackRageClick,l=i.clickObservable,u=i.selectionObservable,c=[],s={},d=null;function f(e){c=[],s={},e&&(De(s,e),c.push(e))}var v=J(l.filter(function(e){return a("click",e.closestTrackedAncestor)}),function(e){return n(t,void 0,void 0,function(){var t;return r(this,function(n){return De(s,e),t=null,0===c.length||function(e,t){return e.length>0&&e[e.length-1].closestTrackedAncestor!==t.closestTrackedAncestor}(c,e)||function(e,t){var n=e[Math.max(0,e.length-4+1)];return t.timestamp-n.timestamp>=1e3}(c,e)||s.isOutOfBounds?(d&&(t=Ie(c)),f(e)):c.push(e),d&&(clearTimeout(d.timerId),d.resolve(t),d=null),c.length>=4?[2,new Promise(function(e){d={resolve:e,timerId:setTimeout(function(){e(Ie(c))},1e3)}})]:[2,null]})})}),p=null==u?void 0:u.subscribe(function(){f()}),h=v.subscribe(function(e){null!==e&&o.track("[Amplitude] Rage Click",e.rageClickEvent,{time:e.time})});return{unsubscribe:function(){h.unsubscribe(),null==p||p.unsubscribe()}}}var qe,He;!function(e){e.INCREASING="increasing",e.DECREASING="decreasing"}(qe||(qe={})),function(e){e.X="x",e.Y="y"}(He||(He={}));function Ue(e){var t=e.changes,n=e.changesThreshold,r=e.thresholdMs;return!(t.length<n)&&t[t.length-1]-t[0]<r}function Ge(e){e.changes=[],e.startTime=void 0}function Xe(e){for(var t=e.changes,n=e.thresholdMs,r=0,o=t[t.length-1];r<t.length;r++){if(o-t[r]<n)break}0!==r&&(e.startTime=t[r],e.changes.splice(0,r))}var Fe=function(e){var t=e.mouseDirectionChangeObservable,n=e.directionChanges,r=void 0===n?10:n,o=e.thresholdMs,i=void 0===o?2e3:o;return new W(function(e){var n={changes:[],changesThreshold:r,thresholdMs:i},o={changes:[],changesThreshold:r,thresholdMs:i},a=void 0,l=null;function u(){void 0!==a&&(e.next(a),a=void 0,null!==l&&clearTimeout(l),Ge(n),Ge(o))}return t.subscribe(function(e){null!==l&&clearTimeout(l),function(e){var t=+Date.now();e.startTime=e.startTime||t;var n=e.changes,r=e.changesThreshold;n.push(t),n.length>r&&n.shift()}(e===He.X?n:o);var t=function(e,t){var n=void 0;if(Ue(e)&&(n=e.startTime),Ue(t)){var r=t.startTime;r&&(!n||r<n)&&(n=r)}return n}(n,o);return t?(a=a||t,l=setTimeout(function(){u(),l=null},i)):u(),Xe(n),Xe(o),function(){null!==l&&(clearTimeout(l),l=null)}})})},Be=function(e){var t=e.amplitude,n=e.options,r=e.allObservables,o=e.directionChanges,i=void 0===o?10:o,a=e.thresholdMs,l=void 0===a?2e3:a,u=function(e){var t=e.allWindowObservables.mouseMoveObservable;return new W(function(e){var n=null,r=null,o=null;return t.subscribe(function(t){var i={x:t.clientX,y:t.clientY};null!==n?(i.x>n.x?(r===qe.DECREASING&&e.next(He.X),r=qe.INCREASING):i.x<n.x&&(r===qe.INCREASING&&e.next(He.X),r=qe.DECREASING),i.y>n.y?(o===qe.DECREASING&&e.next(He.Y),o=qe.INCREASING):i.y<n.y&&(o===qe.INCREASING&&e.next(He.Y),o=qe.DECREASING),n=i):n=i})})}({allWindowObservables:r});return Fe({mouseDirectionChangeObservable:u,directionChanges:i,thresholdMs:l}).subscribe(function(e){ue(n)&&t.track("[Amplitude] Thrashed Cursor",void 0,{time:e})})};function Ye(e,t,n,r){if(!r)return[];var o=e[t];return"object"==typeof o&&null!==o&&"cssSelectorAllowlist"in o&&Array.isArray(o.cssSelectorAllowlist)?o.cssSelectorAllowlist:n}var ze=4e3;e.DataExtractor=Ee,e.WindowMessenger=Te,e.autocapturePlugin=Ne,e.frustrationPlugin=function(e){var l;void 0===e&&(e={});var u="@amplitude/plugin-frustration-browser",c=[],s=!1!==e.errorClicks;e.errorClicks||(s=!1);var d=!1!==e.deadClicks&&null!==e.deadClicks,f=!1!==e.rageClicks&&null!==e.rageClicks,v=!1!==e.thrashedCursor&&null!==e.thrashedCursor;e.thrashedCursor||(v=!1);var p=Ye(e,"rageClicks",E,f),h=Ye(e,"deadClicks",y,d),m=Ye(e,"errorClicks",w,s),b=null!==(l=e.dataAttributePrefix)&&void 0!==l?l:g,T=new Ee(e),k=a([],i(new Set(a(a(a([],i(p),!1),i(h),!1),i(m),!1))),!1),x=function(){var e,n,r=Z(Ce("pointerdown").map(function(e){return T.addAdditionalEventProperties(e,"click",k,b,!0)})),o=Z(Oe().map(function(e){return T.addTypeAndTimestamp(e,"error")})),i=Z(Ae().map(function(e){return T.addAdditionalEventProperties(e,"mutation",k,b)}));window.navigation&&(n=Z(new W(function(e){var n=function(n){e.next(t(t({},n),{type:"navigate"}))};return window.navigation.addEventListener("navigate",n),function(){window.navigation.removeEventListener("navigate",n)}}).map(function(e){return T.addAdditionalEventProperties(e,"navigate",k,b)})));var a=Z(new W(function(e){var t=function(){var t=document.activeElement;if(t&&("TEXTAREA"===t.tagName||"INPUT"===t.tagName)){try{if(t.selectionStart===t.selectionEnd)return}catch(e){return}return e.next()}var n=window.getSelection();if(n&&!n.isCollapsed)return e.next()};return window.document.addEventListener("selectionchange",t),function(){window.document.removeEventListener("selectionchange",t)}})),l=Z(new W(function(e){var t=function(t){e.next(t)},n={capture:!0};return xe.document.addEventListener("mousemove",t,n),function(){xe.document.removeEventListener("mousemove",t,n)}}));return(e={})[ke.ClickObservable]=r,e[ke.MutationObservable]=i,e[ke.NavigateObservable]=n,e[ke.BrowserErrorObservable]=o,e[ke.SelectionObservable]=a,e[ke.MouseMoveObservable]=l,e};return{name:u,type:"enrichment",setup:function(o,i){return n(void 0,void 0,void 0,function(){var n,a,l,g,y,w,E,k,A,C,O;return r(this,function(r){return"undefined"==typeof document||(n=x(),f&&(a=ce(e,p),l=je({allObservables:n,amplitude:i,shouldTrackRageClick:a}),c.push(l)),d&&(g=ce(e,h),y=function(e){var n=e.amplitude,r=e.allObservables,o=e.getEventProperties,i=e.shouldTrackDeadClick,a=r.clickObservable,l=r.mutationObservable,u=r.navigateObservable,c=a.filter(function(e){return pe(e)&&i("click",e.closestTrackedAncestor)&&e.event.target instanceof Element&&null===e.event.target.closest('a[target="_blank"]')&&e.event.button===ve.LEFT_OR_TOUCH_CONTACT}),s=u?K(l,u):l,d=K(c,s),f=null;return J(d,function(e){return f&&Re.includes(e.type)?(clearTimeout(f),f=null,Promise.resolve(null)):"click"===e.type?f?Promise.resolve(null):new Promise(function(t){f=setTimeout(function(){t(e),f=null},3e3)}):Promise.resolve(null)}).subscribe(function(e){if(e){var r={"[Amplitude] X":e.event.clientX,"[Amplitude] Y":e.event.clientY};n.track("[Amplitude] Dead Click",t(t({},o("click",e.closestTrackedAncestor)),r),{time:e.timestamp})}})}({amplitude:i,allObservables:n,getEventProperties:function(e,t){return T.getEventProperties(e,t,b)},shouldTrackDeadClick:g}),c.push(y)),s&&(w=ce(e,m),E=function(e){var n=e.amplitude,r=e.allObservables,o=e.shouldTrackErrorClick,i=r.clickObservable,a=r.browserErrorObservable,l=i.filter(function(e){return pe(e)&&o("click",e.closestTrackedAncestor)&&e.event.target instanceof Element&&null===e.event.target.closest('a[target="_blank"]')&&e.event.button===ve.LEFT_OR_TOUCH_CONTACT}),u=null,c=null,s=function(){null!==u&&(clearTimeout(u),u=null),c=null};return K(l,a).subscribe(function(e){var r;if("click"===e.type)return s(),c=e,void(u=setTimeout(s,2e3));"error"===e.type&&c&&(n.track("[Amplitude] Error Click",t(((r={})["[Amplitude] Kind"]=e.event.kind,r["[Amplitude] Message"]=e.event.message,r["[Amplitude] Stack"]=e.event.stack,r["[Amplitude] Filename"]=e.event.filename,r["[Amplitude] Line Number"]=e.event.lineNumber,r["[Amplitude] Column Number"]=e.event.columnNumber,r),c.targetElementProperties)),s())})}({amplitude:i,allObservables:n,shouldTrackErrorClick:w}),c.push(E)),v&&(k=void 0,A=void 0,"object"==typeof e.thrashedCursor&&(k=e.thrashedCursor.directionChanges,A=e.thrashedCursor.threshold,k&&k<5&&(o.loggerProvider.warn("'thrashedCursor.directionChanges' of ".concat(k," is below the minimum of ").concat(5,", setting to ").concat(5)),k=5),A&&A>ze&&(o.loggerProvider.warn("'thrashedCursor.threshold' of ".concat(A," is above the maximum of ").concat(ze,", setting to ").concat(ze)),A=ze)),C=Be({amplitude:i,options:e,allObservables:n,directionChanges:k,thresholdMs:A}),c.push(C)),null===(O=null==o?void 0:o.loggerProvider)||void 0===O||O.log("".concat(u," has been successfully added."))),[2]})})},execute:function(e){return n(void 0,void 0,void 0,function(){return r(this,function(t){return[2,e]})})},teardown:function(){return n(void 0,void 0,void 0,function(){var e,t,n,i;return r(this,function(r){try{for(e=o(c),t=e.next();!t.done;t=e.next())t.value.unsubscribe()}catch(e){n={error:e}}finally{try{t&&!t.done&&(i=e.return)&&i.call(e)}finally{if(n)throw n.error}}return[2]})})}}},e.plugin=Ne,Object.defineProperty(e,"__esModule",{value:!0})});
